<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
     <link rel="stylesheet" href="style.css">
    <title>ระบบลงเวลาปฏิบัติงาน</title>
  </head>
  <body>

 <div class="container">
        <div class="login-box">
            <h2>ลงเวลาปฏิบัติงาน</h2>
		<div style="text-align: center;">
           <p style="font-size:14px; color:#E0FFFF;">ในสังกัดสำนักงานสาธารณสุขอำเภอเซกา</p>
            <iframe src="https://free.timeanddate.com/clock/i8z1mdj5/n3376/tlth39/fn14/fs20/fc0ef/tct/pct/ftb/th1" frameborder="0" width="93" height="26" allowtransparency="true"></iframe>
            </div>
	<form>
		<select  id="typea" class="btn2" >
  			<option value="">ปฏิบัติงานตามปกติ</option>
            		<option value="ปฏิบัติงานนอกสถานที่">ปฏิบัติงานนอกสถานที่</option>
  			<option value="ปฏิบัติงานในวันหยุดเสาร์ อาทิตย์ และหยุดราชการ">ปฏิบัติงานในวันหยุดเสาร์ อาทิตย์ และหยุดราชการ</option>
			<option value="ไปราชการ">ไปราชการ</option>
			<option value="เข้ารับการฝึกอบรม">เข้ารับการฝึกอบรม</option>
  			<option value="ไปช่วยราชการ">ไปช่วยราชการ</option>
  			<option value="มาช่วยราชการ">มาช่วยราชการ</option>
           		 <option value="อื่นๆ">อื่นๆ โปรดระบุเพิ่มเติม</option>
		</select> 
		    <div class="input-box">
                    <input  id="nte" name="nte" type="text" placeholder="รายละเอียด" autofocus>
                    <label>บันทึกเพิ่มเติม</label>
                </div>
              <div class="forgot-pass">
                    <!--a href="https://liff.line.me/1654797991-3mwO60Od">ลืมลงเวลา?</a-->
                </div>
              <div id="cin" class="invisible"><button id="cin" type="button" class="btn btn-success" onclick="getLocationcheckin()" data-toggle="modal" data-target="#inModal">ลงเวลามา</button></div>
              <div id="creq" class="invisible"><button id="creq" type="button" class="btn btn-primary" onclick="window.location.href='https://liff.line.me/1654797991-8K5AMpAz';">ลงเวลา(บันทึกชี้แจง)</button></div>
              <div id="cout" class="invisible"><button id="cout" type="button" class="btn btn-danger" onclick="getLocationcheckout()" data-toggle="modal" data-target="#outModal">ลงเวลากลับ</button></div>     <div class="signup-link">
                   <a data-toggle="modal" data-target="#exampleModal">ตรวจสอบพิกัด/ลงทะเบียน</a>
                </div>
		    <div style="text-align: center;">
                <p id="demo" style="font-size:1px; color:#E0FFFF;"></p>
		</div>
            </form>
        </div>

        <span style="--i:0;"></span>
        <span style="--i:1;"></span>
        <span style="--i:2;"></span>
        <span style="--i:3;"></span>
        <span style="--i:4;"></span>
        <span style="--i:5;"></span>
        <span style="--i:6;"></span>
        <span style="--i:7;"></span>
        <span style="--i:8;"></span>
        <span style="--i:9;"></span>
        <span style="--i:10;"></span>
        <span style="--i:11;"></span>
        <span style="--i:12;"></span>
        <span style="--i:13;"></span>
        <span style="--i:14;"></span>
        <span style="--i:15;"></span>
        <span style="--i:16;"></span>
        <span style="--i:17;"></span>
        <span style="--i:18;"></span>
        <span style="--i:19;"></span>
        <span style="--i:20;"></span>
        <span style="--i:21;"></span>
        <span style="--i:22;"></span>
        <span style="--i:23;"></span>
        <span style="--i:24;"></span>
        <span style="--i:25;"></span>
        <span style="--i:26;"></span>
        <span style="--i:27;"></span>
        <span style="--i:28;"></span>
        <span style="--i:29;"></span>
        <span style="--i:30;"></span>
        <span style="--i:31;"></span>
        <span style="--i:32;"></span>
        <span style="--i:33;"></span>
        <span style="--i:34;"></span>
        <span style="--i:35;"></span>
        <span style="--i:36;"></span>
        <span style="--i:37;"></span>
        <span style="--i:38;"></span>
        <span style="--i:39;"></span>
        <span style="--i:40;"></span>
        <span style="--i:41;"></span>
        <span style="--i:42;"></span>
        <span style="--i:43;"></span>
        <span style="--i:44;"></span>
        <span style="--i:45;"></span>
        <span style="--i:46;"></span>
        <span style="--i:47;"></span>
        <span style="--i:48;"></span>
        <span style="--i:49;"></span>
    </div>
<!-- Modal-in -->
<div class="modal fade" id="inModal" tabindex="-1" role="dialog" aria-labelledby="inModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="inModalLabel">กรุณาตรวจสอบพิกัดและกดยืนยันการลงเวลาปฏิบัติงาน</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		<p id="indemo" >กำลังโหลดข้อมูล...</p>
      </div>
      <div class="modal-footer">
<!--         <div class="signup-link"><a href="https://liff.line.me/1654797991-BXng4Kgv">ลงทะเบียน</a></div> -->
        <button type="button" class="btn btn-success" onclick="getLocation()" >ยืนยันการลงเวลาปฏิบัติงาน</button>
	      <!--button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa-solid fa-xmark">ปิด</button-->
      </div>
    </div>
  </div>
</div>
<!-- Modal-out -->
<div class="modal fade" id="outModal" tabindex="-1" role="dialog" aria-labelledby="outModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="outModalLabel">กรุณาตรวจสอบพิกัดและกดยืนยันการลงเวลากลับ</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		<p id="outdemo" >กำลังโหลดข้อมูล...</p>
      </div>
      <div class="modal-footer">
<!--         <div class="signup-link"><a href="https://liff.line.me/1654797991-BXng4Kgv">ลงทะเบียน</a></div> -->
        <button type="button" class="btn btn-danger" onclick="getLocationOut()" >ยืนยันการลงเวลากลับ</button>
	      <!--button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa-solid fa-xmark">ปิด</button-->
      </div>
    </div>
  </div>
</div>
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">ทดสอบระยะห่างจากสำนักงาน</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
		<p id="cdemo" ></p>
      </div>
      <div class="modal-footer">
<!--         <div class="signup-link"><a href="https://liff.line.me/1654797991-BXng4Kgv">ลงทะเบียน</a></div> -->
        <button type="button" class="btn btn-success" onclick="getLocationcheck()" >ทดสอบ</button>
	<button type="button" class="btn btn-info" onclick="window.location.href='https://liff.line.me/1654797991-BXng4Kgv';" >ลงทะเบียน</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa-solid fa-xmark">ปิด</button>
      </div>
    </div>
  </div>
</div>

<script>


	
window.onload = function() {

	Swal.fire({
  title: 'กด ตกลง เพื่อใช้งานเวอร์ชั่นใหม่',
  text: 'เวอร์ชั่นนี้หยุดการอัพเดพแล้ว',
  icon: 'info',
  confirmButtonColor: '#3085d6',
  cancelButtonColor: '#d33',
  confirmButtonText: 'ตกลง'
}).then((result) => {
  if (result.isConfirmed) {
    window.location.href = 'https://liff.line.me/1654797991-WVJ2e129';
  }
});

	
  initializeLiff('1654797991-nolGabGZ');
}

const xurl = "https://script.google.com/macros/s/AKfycbwhSS79s4ce9Tt8PFkoKzC7VYdB2szZBBatTryw03cvFQh-x1l4NEEsAy28b6s7SE8e/exec";
const curl = "https://script.google.com/macros/s/AKfycbwO2YNyCJar3dVQQ3fmWNmgzWDWVlo4D5Ska7pWLEXxcHWeVtFbeLHUTrKodLkDqdcU/exec";
function checks(){

var today = new Date();
today.toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' })
var hm = today.toLocaleTimeString('th-TH');

        if(hm <= "08:30" ){
          document.getElementById("cin").classList.remove('invisible');
        }else if(hm >= "16:30"){
          document.getElementById("cout").classList.remove('invisible');
            }else{
        document.getElementById("creq").classList.remove('invisible');
            }
}


function initializeLiff(myLiffId) {
    liff
        .init({
            liffId: myLiffId
        })
        .then(() => {
            checks();
        })
        .catch((err) => {
        });
}

var x = document.getElementById("demo");
var c = document.getElementById("cdemo");
var inx = document.getElementById("indemo");
var outx = document.getElementById("outdemo");
	
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
var sel = document.getElementById("typea").value;
var ntex = document.getElementById("nte").value;
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
            var uname = profile.displayName;
        var xos = liff.getOS();
  x.innerHTML = "พิกัด: " + position.coords.latitude + 
  "," + position.coords.longitude;
var xmlhttp = new XMLHttpRequest();
        var theUrl = xurl+"?ctype=In&sel="+sel+"&ntex="+ntex+"&xos="+xos+"&user="+uid+"&name="+uname+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrl);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
	                swal.fire({
                  position: 'center-start',
                  confirmButtonColor: '#1450A3',
                  confirmButtonText: 'ตกลง',
                html: jsonResponse.desc,
                
              }).then(function() {
                liff.closeWindow();
            });
      //  alert(jsonResponse.desc);
      //  liff.closeWindow();
      }});  
}



///////////////////////////////


function getLocationOut() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPositionOut);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPositionOut(position) {
var sel = document.getElementById("typea").value;
var ntex = document.getElementById("nte").value;
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
            var uname = profile.displayName;
        var xos = liff.getOS();
  x.innerHTML = "พิกัด: " + position.coords.latitude + 
  "," + position.coords.longitude;
var xmlhttp = new XMLHttpRequest();
        var theUrl = xurl+"?ctype=Out&sel="+sel+"&ntex="+ntex+"&xos="+xos+"&user="+uid+"&name="+uname+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrl);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
                swal.fire({
                  position: 'center-start',
                  confirmButtonColor: '#1450A3',
                  confirmButtonText: 'ตกลง',
                html: jsonResponse.desc,
                
              }).then(function() {
                liff.closeWindow();
            });
		    
      //  alert(jsonResponse.desc);
      //  liff.closeWindow();
      }});  
}

// ตรวจสอบพิกัด
function getLocationcheck() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPositioncheck);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPositioncheck(position) {
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
     x.innerHTML = "พิกัด: " + position.coords.latitude + 
  "," + position.coords.longitude;
var xmlhttp = new XMLHttpRequest();
        var theUrls = curl+"?id="+uid+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrls);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
	 const Toast = Swal.mixin({
  toast: true,
  position: 'top-start',
  showConfirmButton: false,
  timer: 4000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

Toast.fire({
  icon: 'success',
  title: 'การทดสอบสำเร็จ'
})
        
	c.innerHTML = c.innerHTML+"<br>"+jsonResponse.desc;
       // alert(jsonResponse.desc);
       // liff.closeWindow();
      }});  
}
// ตรวจสอบพิกัด มา
function getLocationcheckin() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPositioncheckin);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPositioncheckin(position) {
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
     x.innerHTML = "พิกัด: " + position.coords.latitude + 
  "," + position.coords.longitude;
var xmlhttp = new XMLHttpRequest();
        var theUrls = curl+"?id="+uid+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrls);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
	 const Toast = Swal.mixin({
  toast: true,
  position: 'top-start',
  showConfirmButton: false,
  timer: 4000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

Toast.fire({
  icon: 'success',
  title: 'โหลดตำแหน่งปัจจุบันสำเร็จ'
})
        
	inx.innerHTML = jsonResponse.desc;
       // alert(jsonResponse.desc);
       // liff.closeWindow();
      }});  
}

// ตรวจสอบพิกัด กลับ
function getLocationcheckout() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPositioncheckout);
  } else { 
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPositioncheckout(position) {
     liff.getProfile().then(function(profile) {
            var uid = profile.userId;
     x.innerHTML = "พิกัด: " + position.coords.latitude + 
  "," + position.coords.longitude;
var xmlhttp = new XMLHttpRequest();
        var theUrls = curl+"?id="+uid+"&lat="+position.coords.latitude+"&long="+position.coords.longitude;
        xmlhttp.open('GET', theUrls);
        xmlhttp.send();
            xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var jsonResponse = JSON.parse(this.responseText);
        }
	 const Toast = Swal.mixin({
  toast: true,
  position: 'top-start',
  showConfirmButton: false,
  timer: 4000,
  timerProgressBar: true,
  didOpen: (toast) => {
    toast.addEventListener('mouseenter', Swal.stopTimer)
    toast.addEventListener('mouseleave', Swal.resumeTimer)
  }
})

Toast.fire({
  icon: 'success',
  title: 'โหลดตำแหน่งปัจจุบันสำเร็จ'
})
        
	outx.innerHTML = jsonResponse.desc;
       // alert(jsonResponse.desc);
       // liff.closeWindow();
      }});  
}

</script>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-borderless/borderless.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
  </body>
</html>
